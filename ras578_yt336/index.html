
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0095)http://people.ece.cornell.edu/land/courses/ece4760/FinalProjects/s2011/pss83/Website/index.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="Content-Language" content="en-us">
<title>ECE 4760</title>
<link rel="stylesheet" type="text/css" media="all" href="webpage_files/cornell_main.css">
<link rel="stylesheet" type="text/css" media="all" href="webpage_files/cornell_1column.css">
<link rel="stylesheet" type="text/css" media="all" href="webpage_files/main.css">
<meta name="author" content="Raghav Subramaniam, Jeff Tian">
<meta name="copyright" content="Copyright (c) 2014 Raghav Subramaniam, Jeff Tian">
<meta name="description" content="ECE 4760 Final Project: Ukule-LED">
<meta name="keywords" content="">
<style type="text/css">
.c1 {line-height:1.0;direction:ltr}
.c25 {text-align:center}
.c0 {height:11pt;direction:ltr}
.c13 {vertical-align:top;width:69.8pt;border-style:solid;border-color:#000000;border-width:1pt;padding:5pt 5pt 5pt 5pt}
.c16 {vertical-align:top;width:73.5pt;border-style:solid;border-color:#000000;border-width:1pt;padding:5pt 5pt 5pt 5pt}
.c19 {line-height:1.0}
.c21 {vertical-align:baseline;color:#000000;font-size:11pt;font-style:normal;font-family:"Arial";text-decoration:none}
.c22 {vertical-align:top;width:213.8pt;border-style:solid;border-color:#000000;border-width:1pt;padding:5pt 5pt 5pt 5pt}
.c23 {padding-top:0pt;text-align:left;padding-bottom:0pt}
.c3 {vertical-align:top;width:85.5pt;border-style:solid;border-color:#000000;border-width:1pt;padding:5pt 5pt 5pt 5pt}
.c33 {vertical-align:top;width:57.8pt;border-style:solid;border-color:#000000;border-width:1pt;padding:5pt 5pt 5pt 5pt}
.c37 {margin-right:auto;border-collapse:collapse}
.c38 {text-indent:-0.8pt}
.c5 {font-weight:bold}
.c8 {height:26pt}
.c9 {height:0pt}
</style></head>
<body>

<div id="header">
  <!-- The following div contains the Cornell University logo and search link -->
  <div id="cu-identity"> 
    <div id="cu-logo"> 
      <a href="http://www.ece.cornell.edu/"><img src="webpage_files/cu_logo.gif" alt="Cornell University" width="340" height="75" border="0"></a> 
    </div> 
  </div>
  <div class="linklist"> <a name="top"></a> </div>
  <!-- The search-form div contains a form that allows the user to search 
        either pages or people within cornell.edu directly from the banner. -->
  <div id="search-form">
    <form action="http://www.cornell.edu/search/" method="get" enctype="application/x-www-form-urlencoded">
      <div id="search-input">
        <label for="search-form-query">SEARCH:</label>
        <input type="text" id="search-form-query" name="q" value="" size="20">
        <input type="submit" id="search-form-submit" name="submit" value="go">
      </div>
      <div id="search-filters">
        <input type="radio" id="search-filters1" name="tab" value="" checked="checked">
        <label for="search-filters1">Pages</label>
        <input type="radio" id="search-filters2" name="tab" value="people">
        <label for="search-filters2">People</label>
        <a href="http://www.cornell.edu/search/">more options</a>
      </div>
    </form>
  </div>
</div>
<div id="mainnav">
  <ul>
    <li><a href="#design">High&nbsp;Level&nbsp;Design</a></li>
    <li><a href="#software">Software</a></li>
    <li><a href="#hardware">Hardware</a></li>
    <li><a href="#results">Results</a></li>
    <li><a href="#conclusions">Conclusions</a></li>
    <li><a href="#appendices">Appendices</a></li>
  </ul>
</div>
<!-- end mainnav -->
<!-- end header -->
<div id="sectiontitle">
  <h4><a href="http://people.ece.cornell.edu/land/courses/ece4760/">ECE 4760</a>: <a href="http://people.ece.cornell.edu/land/courses/ece4760/FinalProjects/">Final Project</a></h4>
  <h1>Ukule-LED</h1>
  <h2>&nbsp;</h2>
  <h3>Raghav Subramaniam (<a href="mailto:ras578@cornell.edu">ras578@cornell.edu)</a></h3>
  <h3>Jeff Tian (<a href="mailto:yt336@cornell.edu">yt336@cornell.edu</a>)</h3>
</div>
<div id="wrapper">
  <div id="content">
    <div id="maincontent" class="hub">
    
      <div id="introblurb">
        <div id="pullquote">
          <p class="quote">"A ukulele thing."</p>
          <p class="source">project soundbyte</p>
        </div>
        <p dir="ltr">placeholder text</p>
        <br>
        <div class="image">
          <p class="c1 c25"><img src="webpage_files/placeholder.jpg" width="300" height="200"></p>
          <p class="caption">placeholder caption</p>
        </div>
      </div>
      
      <div class="linklist"><a name="design"></a>
        <h2>High Level Design &nbsp;&nbsp;&nbsp;<font size="-1"><strong><a href="#top">top</a></strong></font></h2>
        
        <p dir="ltr"><strong>Rationale and Inspiration</strong></p>

        <p dir="ltr"><strong>Math</strong></p>

        <p dir="ltr"><strong>Logical Structure</strong></p>

        <p dir="ltr"><strong>Hardware Tradeoffs</strong></p>

        <p dir="ltr"><strong>Software Tradeoffs</strong></p>

      </div>
     
      <div class="linklist"> <a name="software"></a>
        <h2>Software Design &nbsp;&nbsp;&nbsp;<font size="-1"><strong><a href="#top">top</a></strong></font></h2>

        <div class="image">
          <p class = "c1 c25"><img src="webpage_files/software.jpg" alt="" width="500" height="350"></a></p>
          <p class="caption">Figure 2: Program Overview (Functions in dashed boxes represent real-time tasks)</p>
        </div>

        <p><strong>Command Line Interface</strong></p>
        <p>To interact with the microcontroller, our project requires a desktop or laptop running Python. On this side, our user interface is a simple command line interface. There are two command formats it can take: <code>ukule_led practice "chord" port "portname"</code> and <code>ukule_led play "file" port "portname"</code>. <p>The first command type tells the microcontroller to go into practice mode, where the LEDs for a single chord are held on indefinitely (until the user specifies a different chord in practice mode or switches to play mode). The arguments for this mode are "chord", which is the chord to be played (for example "A", "C#m", "Gb7", etc), and the other argument is "portname", which is the port on the computer which is connected through USB serial cable to the microcontroller.</p><p> The second command type tells the microcontroller to go into practice mode, which plays the specified song by lighting the LEDs corresponding to the song chords sequentially according to the chord duration. The arguments are "file" which specifies the path to the song file on the local OS, and "port" which is serves the same function as previously described.</p>
        </p> <p>
          To implement this functionality we used the python library docopt, which allows us to easily define different command types and parse the command line arguments
        </p>  
        <p><strong>Music File Parsing</strong></p>
        <p><strong>File Serial Transmission</strong></p>
        <p><strong>Initialization</strong></p>
        <p><strong>TRT and Scheduling</strong></p>
        <p><strong>Receiving From Serial Port</strong></p>
        <p><strong>Real-time LED Driving</strong></p>
        <p><strong>Chord Lookup Table Generation</strong></p>


      </div>

      <div class="linklist"> <a name="hardware"></a>
        <h2>Hardware Design&nbsp;&nbsp;&nbsp;<font size="-1"><strong><a href="#top">top</a></strong></font></h2>

        <p>Our electronic components included an ATmega1284P microcontroller mounted on a custom PCB and 16 WS2812B RGB LEDs. These were soldered to a small solder board, along with various resistors, capacitors, jumper wires, and 6 header pins for connecting to a serial cable.</p>

        <p><strong>ATmega1284P Microcontroller</strong></p>

        <p>We originally decided to use the 1284P because we wanted to use Timer 3's fast PWM mode to drive our RGB LEDs. When we realized that we couldn't quite meet the LED timing specifications, we no longer needed to use the 1284P.</p>

        <p>However, we decided to stick with the 1284P for convenience. We already had a custom PCB built, which included all of the necessary power circuits. We also avoided having to learn a new microcontroller datasheet.</p>

        <p><strong>WS2812B RGB LEDs</strong></p>

        <p>We used Adafruit's NeoPixel Mini PCBs, each of which includes a WS2812B RGB LED and the necessary capacitor, as given in the WS2812B datasheet. We decided to use the PCBs instead of directly using the LEDs to make soldering easier.</p>

        <p>All of the RGB LEDs are driven from a single microcontroller I/O pin. As per the datasheet, they were all connected in series, with the Dout, 5V, and gnd pads of one wired to the Din, 5V, and gnd pads of the next. The Din pin of the first LED is connected to PORTA.0 on the microcontroller through a 330 ohm resistor to protect the first LED from any voltage spike, and the Dout pin of the last LED is not connected to anything. There is a 100 uF capacitor between the 5V and gnd lines, used to prevent large inrush currents from destroying </p>

        <p>Soldering the LEDs together is the most challenging part of building the Ukule-LED hardware. There should be four groups of four NeoPixel PCBs. The Din, Dout, 5V, and gnd pins of each group need to connected as described in the previous paragraph. We used very short lengths of wire, soldered to the pads on the NeoPixel PCBs, such that there was about 1-2 mm of space between each PCB. Next, these four groups need to be wired together. We used 3 approximately 4 cm lengths of wire to connect these. Finally, all 16 NeoPixel PCBs were to be hooked to the solder board with 3 approximately 50 cm lengths of wire. The LED configuration is shown in Figure <strong>X</strong>.</p>

        <div class="image">
          <p class = "c1 c25"><img src="webpage_files/placeholder.jpg" alt="" width="300" height="200"></a></p>
          <p class="caption">placeholder caption</p>
        </div>

        <p><strong>Serial Connection</strong></p>

        <p>We used a UART-to-USB cable to enable communication between the host PC and the microcontroller. The user specifies a song file path, then the Python CLI converts this file into a string and sends it through the cable to the microcontroller.</p>

        <p><strong>Power</strong></p>

        <p>According to the <a href="https://learn.adafruit.com/adafruit-neopixel-uberguide/power">power</a> section of the Adafruit NeoPixel Überguide, each RGB LED driven at maximum brightness consumes 60 mA of current, resulting in a total current draw of 960 mA for 24 RGB LEDs.However, we drove a maximum of 4 LEDs at a time, with the macro <code>INTENS</code> to 20, out of a maximum value of 256. A back-of-the-envelope calculation gives approximately 18.75 mA of current, which is well below the absolute maximum DC current of 40 mA, given in the microcontroller's datasheet. As such, we decided that we could drive the RGB LEDs with a microcontroller pin, instead of resorting to an external power source as the Überguide suggested. We had no trouble with this.</p>

        <p>We were able to use a single 9V power supply for all of our power needs. We decided against using a 9V battery because the system has to be tethered to a computer via serial cable anyways, and another cable coming out of the system is not a major inconvenience at that point.</p>

        <p><strong>Ukulele</strong></p>

        <p>To prepare the ukulele for our project, we had to dremel out the fretboard up to the fourth fret in to accomodate the RGB LEDs. We had to keep all the frets intact and keep the LEDs below the frets in order to maintain playability of the ukulele. We considered using epoxy to make the fretboard above the LEDs smooth, but we were worried that we wouldn't be able to keep the epoxy contained.</p>

        <p>We hot glued four sets of four LED to the dremeled grooves in the fretboard. We also hot glued the microcontroller and the solder board to the end of the ukulele opposite the fretboard, as shown in Figure <strong>X</strong>. Overall, we didn't add too much mass to the ukulele.</p>

        <div class="image">
          <p class = "c1 c25"><img src="webpage_files/placeholder.jpg" alt="" width="300" height="200"></a></p>
          <p class="caption">placeholder caption</p>
        </div>
        
      </div>
      
      <div class="linklist"> <a name="results"></a>
        <h2>Results &nbsp;&nbsp;&nbsp;<font size="-1"><strong><a href="#top">top</a></strong></font></h2>

        <p dir="ltr"><strong>Speed of Execution</strong></p>

        <p dir="ltr"><strong>Accuracy</strong></p>

        <p dir="ltr"><strong>User Evaluation</strong></p>

        <p dir="ltr"><strong>Safety</strong></p>

        <p dir="ltr"><strong>Interference with Other Designs</strong></p>

        <p dir="ltr"><strong>Usability</strong></p>

      </div>

      <div class="linklist"> <a name="conclusions"></a>
        <h2>Conclusions &nbsp;&nbsp;&nbsp;<font size="-1"><strong><a href="#top">top</a></strong></font></h2>

        <p dir="ltr"><strong>Standards</strong></p>

        <p dir="ltr"><strong>Intellectual Property Considerations</strong></p>

        <p dir="ltr"><strong>Ethical Considerations</strong></p>

        <p dir="ltr"><strong>Legal Considerations</strong></p>

      </div>

      <h2>Appendices &nbsp;&nbsp;&nbsp;<font size="-1"><strong><a href="#top">top</a></strong></font></h2>

        <h3>A. Schematics</h3>
        <div class="image">
          <p class = "c1 c25"><img src="webpage_files/schematic_highlevel.jpg" alt="" width="600" height="270"></a></p>
          <p class="caption">High-Level Hardware Schematic</p>
        </div>

        <h3>B. Cost Details</h3>
        <div dir="ltr">
          <table width="769" cellpadding="0" cellspacing="0">
            <tbody>
              <tr class="c9">
                <td width="303" class="c22"><p class="c1"><span class="c5">Part Number</span></p></td>
                <td width="111" class="c13"><p class="c23 c1"><span class="c5">Vendor</span></p></td>
                <td width="95" class="c33"><p class="c23 c1"><span class="c5">Quantity</span></p></td>
                <td width="132" class="c3"><p class="c1"><span class="c5">Price</span></p></td>
                <td width="116" class="c16"><p class="c23 c1"><span class="c5">Total Cost</span></p></td>
              </tr>
              <tr class="c9">
                <td class="c22"><p class="c1"><span>ATmega1284P</span></p></td>
                <td class="c13"><p class="c1"><span>Lab stock</span></p></td>
                <td class="c33"><p class="c1"><span>1</span></p></td>
                <td class="c3"><p class="c1"><span>$5</span></p></td>
                <td class="c16"><p class="c1"><span>$5.00</span></p></td>
              </tr>
              <tr class="c9">
                <td class="c22"><p class="c1"><span>Melokia UK13 13" Soprano Ukulele</span></p></td>
                <td class="c13"><p class="c1 c38"><span>Amazon</span></p></td>
                <td class="c33"><p class="c1 c38"><span>1</span></p></td>
                <td class="c3"><p class="c1 c38"><span>$23.99 </span></p></td>
                <td class="c16"><p class="c1 c38"><span>$23.99</span></p></td>
              </tr>
              <tr class="c9">
                <td class="c22"><p class="c1"><span>NeoPixel Mini PCB - Pack of 5</span></p></td>
                <td class="c13"><p class="c1"><span>Adafruit</span></p></td>
                <td class="c33"><p class="c1"><span>4</span></p></td>
                <td class="c3"><p class="c1"><span>$4.95</span></p></td>
                <td class="c16"><p class="c1"><span>$19.80</span></p></td>
              </tr>
              <tr class="c9">
                <td class="c22"><p class="c1"><span>Small Solder Board</span></p></td>
                <td class="c13"><p class="c1"><span>Lab stock</span></p></td>
                <td class="c33"><p class="c1"><span>1</span></p></td>
                <td class="c3"><p class="c1"><span>$1.00</span></p></td>
                <td class="c16"><p class="c1"><span>$1.00</span></p></td>
              </tr>
              <tr class="c9">
                <td class="c22"><p class="c1"><span>Custom PCB</span></p></td>
                <td class="c13"><p class="c1"><span>Lab stock</span></p></td>
                <td class="c33"><p class="c1"><span>1</span></p></td>
                <td class="c3"><p class="c1"><span>$4</span></p></td>
                <td class="c16"><p class="c1"><span>$4.00</span></p></td>
              </tr>
              <tr class="c9">
                <td class="c22"><p class="c1"><span>Header Pins</span></p></td>
                <td class="c13"><p class="c1"><span>Lab stock</span></p></td>
                <td class="c33"><p class="c1"><span>20</span></p></td>
                <td class="c3"><p class="c1"><span>$0.05 </span></p></td>
                <td class="c16"><p class="c1"><span>$1.00</span></p></td>
              </tr>
              <tr class="c9">
                <td class="c22"><p class="c1"><span>Capacitors</span></p></td>
                <td class="c13"><p class="c1"><span>Lab stock</span></p></td>
                <td class="c33"><p class="c1"><span>1</span></p></td>
                <td class="c3"><p class="c1"><span>$0</span></p></td>
                <td class="c16"><p class="c1"><span>$0.00</span></p></td>
              </tr>
              <tr class="c9">
                <td class="c22"><p class="c1"><span>Resistors</span></p></td>
                <td class="c13"><p class="c1"><span>Lab stock</span></p></td>
                <td class="c33"><p class="c1"><span>1</span></p></td>
                <td class="c3"><p class="c1"><span>$0</span></p></td>
                <td class="c16"><p class="c1"><span>$0.00</span></p></td>
              </tr>
              <tr class="c8">
                <td class="c22"><p class="c1"><span>12V Power Supply</span></p></td>
                <td class="c13"><p class="c1"><span>Lab stock</span></p></td>
                <td class="c33"><p class="c1"><span>1</span></p></td>
                <td class="c3"><p class="c1"><span>$5</span></p></td>
                <td class="c16"><p class="c1"><span>$5.00</span></p></td>
              </tr>
              <tr class="c8">
                <td class="c22"><p class="c1"><span>Serial Cable</span></p></td>
                <td class="c13"><p class="c1"><span>Lab stock</span></p></td>
                <td class="c33"><p class="c1"><span>1</span></p></td>
                <td class="c3"><p class="c1"><span>$7</span></p></td>
                <td class="c16"><p class="c1"><span>$7.00</span></p></td>
              </tr>
              <tr class="c8">
                <td class="c22"><p class="c1"><span>Wire</span></p></td>
                <td class="c13"><p class="c1"><span>Lab stock</span></p></td>
                <td class="c33"><p class="c1"><span>4&rsquo;</span></p></td>
                <td class="c3"><p class="c1"><span>$0</span></p></td>
                <td class="c16"><p class="c1"><span>$0.00</span></p></td>
              </tr>
              <tr class="c8">
                <td class="c22"><p class="c23 c1"><span>Heat Shrink Tubing</span></p></td>
                <td class="c13"><p class="c23 c1"><span>Lab stock</span></p></td>
                <td class="c33"><p class="c23 c1"><span>6&rdquo;</span></p></td>
                <td class="c3"><p class="c23 c1"><span>$0</span></p></td>
                <td class="c16"><p class="c23 c1"><span>$0.00</span></p></td>
              </tr>
              <tr class="c9">
                <td class="c22"><p class="c1"><span class="c5">Total cost</span></p></td>
                <td class="c13"><p class="c23 c0 c19"><span class="c21 c5"></span></p></td>
                <td class="c33"><p class="c23 c0 c19"><span class="c21 c5"></span></p></td>
                <td class="c3"><p class="c0 c19"><span class="c5"></span></p></td>
                <td class="c16"><p class="c23 c1"><span class="c5">$66.79</span></p></td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>C. Distribution of Work</h3>
        <table width="100%" border="1">
          <thead>
            <tr>
              <th width="50%"><strong>Raghav Subramaniam</strong></th>
              <th width="50%"><strong>Jeff Tian</strong></th>
            </tr>
          </thead>
          <tbody>
            <tr class="row1">
              <td>placeholder</td>
              <td>placeholder</td>
            </tr>
            <tr class="row2">
              <td>placeholder</td>
              <td>placeholder</td>
            </tr>
          </tbody>
        </table>

        <h3>D. Code Listing</h3>
        <p>placeholder</p>

        <div class="linklist"><h2>References &nbsp;&nbsp;&nbsp;<font size="-1"><strong><a href="#top">top</a></strong></font></h2>

        <p style="margin: 0 0 0.5em">This section provides links to external reference documents, code, and websites used throughout the project.</p>
        <div class="group1">
          <h3>Datasheets</h3>
          <ul>
            <li><a href="http://people.ece.cornell.edu/land/courses/ece4760/AtmelStuff/mega1284full.pdf">Atmega1284 Datasheet</a></li>
          </ul>
          <h3>References</h3>
          <ul>
          </ul>
        </div>
        <div class="group2">
          <h3>Vendors</h3>
          <ul>
            <li><a href="http://www.adafruit.com/">Adafruit</a></li>
            <li><a href="http://www.amazon.com">Amazon</a></li>
          </ul>
          <h3>Background Info</h3>
          <ul>
          </ul>
        </div>
</div>

        
      </div>
           
        <div class="linklist">
          <h2>Acknowledgements &nbsp;&nbsp;&nbsp;<font size="-1"><strong><a href="#top">top</a></strong></font></h2>

          <p>placeholder text</p>
        </div>
      </div>
    <!-- end maincontent -->
  </div>
  <!-- end content -->
  <script type="text/javascript" async src="webpage_files/ga.js"></script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22818013-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
  <!-- content out -->
  <hr>
  <!-- footer in -->
  <div id="footerwrap">
    <div id="footer">
      <div id="copyright">
        <div class="copyright">(c) 2014 Raghav Subramaniam &amp; Jeff Tian</div>
        <div class="copyright">Style adapted with permission from Eileen Liu</div>
        <div class="copyright">Layout (c) 2010 Cornell University</div>
      </div>
    </div>
    <!-- end footer -->
  </div>
  <!-- end footerwrap -->
  <!-- footer out -->
</div>
<!-- end wrapper -->


<embed type="application/x-shockwave-flash" width="0" height="0"></div></div><iframe id="rdbIndicator" width="100%" height="270" border="0" src="webpage_files/indicator.html" style="display: none; border: 0; position: fixed; left: 0; top: 0; z-index: 2147483647"></iframe></body></html>